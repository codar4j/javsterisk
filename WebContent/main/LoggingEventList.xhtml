<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"    
    			xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
			    template="/WEB-INF/templates/template.xhtml"
			    xmlns:c="http://java.sun.com/jsp/jstl/core"
			    xmlns:my="http://java.sun.com/jsf/composite/components">
      
 <ui:param name="title" value="javsterisk - log4j" />
       
 <ui:define name="body">
 
	<h:form id="formList">

			<p:toolbar>
				<p:toolbarGroup align="left">

					<p:separator />
					
					<p:commandButton type="button" title="Nuevo" icon="ui-icon-document" disabled="true" />

					<p:commandButton id="refreshToolBar" process="@this" title="Actualizar" actionListener="#{logController.searchByDate}" icon="ui-icon-refresh" update=":formList:logList"/>
					
					<p:commandButton id="viewToolBar" type="button" title="Ver" icon="ui-icon-search" disabled="true" />

					<p:separator />
					
					<p:commandButton id="editToolBar" type="button" title="Editar" icon="ui-icon ui-icon-pencil" disabled="true" />

					<p:separator />
					
					<p:commandButton id="deleteToolBar" type="button" title="Eliminar" icon="ui-icon-trash" disabled="true" />
					
					<p:separator />
					
					<p:commandButton id="dateFilterToolBar" global="false" process="@this" title="Buscar por fecha" icon="ui-icon-calendar" update=":formSearch:searchModalDialog" oncomplete="$('.ui-state-error').removeClass('ui-state-error');searchModal.show();"/>									
					
					<p:commandButton type="button" title="Reporte" icon="ui-icon-print" onclick="callBirt('#{facesContext.externalContext.requestContextPath}/frameset?__report=report/logList.rptdesign');" />
					
					<p:separator />
					
					<p:commandButton type="button" title="Ayuda" icon="ui-icon-help" onclick="javascript:alert('En desarrollo')"/>
					
				</p:toolbarGroup>

				<p:toolbarGroup align="right">

					<p:menuButton value="Exportar">
						
						<p:menuitem value="Exportar a XLS" ajax="false" icon="ui-icon-arrowthickstop-1-s">
							<p:dataExporter target=":formList:logList" type="xls" fileName="logList"/>
						</p:menuitem>						
						<p:menuitem value="Exportar a PDF" ajax="false" icon="ui-icon-arrowthickstop-1-s">
							<p:dataExporter target=":formList:logList" type="pdf" fileName="logList"/>
						</p:menuitem>
												
					</p:menuButton>
				</p:toolbarGroup>

			</p:toolbar>
			
			<p:panel>  

			<p:dataTable id="logList" 
        		var="log"         		
        		value="#{logController.logs}" 
        		rowKey="#{log.id}" 
        		scrollRows="16"    
        		scrollable="true"     		        		
        		scrollHeight="400"        		
        		resizableColumns="true"
        		draggableColumns="false"
        		rowStyleClass="#{log.level == 'WARN' ? 'logWarn' : (log.level == 'ERROR' ? 'logError' : null)}"                                    
                filteredValue="#{logController.logFiltered}"                                                       
                widgetVar="logTable">
                
                <p:ajax event="rowToggle" process="@this" partialSubmit="true" listener="#{loggingEventController.onRowToggle}" global="false" />
                <p:ajax event="sort" global="false"/>
                <p:ajax event="filter" global="false"/>
                
                <f:facet name="header">
                	<div align="left">
                		Total de Logging listados : #{loggingEventController.loggingEvents.size() == 0 ? 0 : loggingEventController.loggingEvents.size()}
                	</div>
                </f:facet>
                
                <p:column style="width:2%" exportable="false">  
            		<p:rowToggler id="logRowToggler"/>  
        		</p:column>
                
                <p:column sortBy="#{loggingEvent.date}" width="12%" filterBy="#{loggingEvent.date}" filterMatchMode="contains">  
                	<f:facet name="header">  
            			<h:outputText value="Date" />  
        			</f:facet> 
            		<h:outputText value="#{loggingEvent.date}" />
        		</p:column>        		
        		<p:column sortBy="#{loggingEvent.level_string}" width="10%" filterBy="#{loggingEvent.level_string}" filterOptions="#{loggingEventController.loggerLevelFilter}"  filterMatchMode="exact">
        			<f:facet name="header">  
            			<h:outputText value="Level" />  
        			</f:facet> 
        			<h:outputText style="float:left;" styleClass="#{loggingEvent.level_string == 'INFO' ? 'ui-icon ui-icon-info' : (loggingEvent.level_string == 'WARN' ? 'ui-icon ui-icon-alert' : (loggingEvent.level_string == 'ERROR' ? 'ui-icon ui-icon-circle-minus' : 'ui-icon ui-icon-circle-zoomin'))}" />
        			<h:outputText value="#{loggingEvent.level_string}"/>
        		</p:column>
        		<p:column sortBy="#{loggingEvent.logger_name}" width="25%" filterBy="#{loggingEvent.logger_name}" filterMatchMode="contains">
        			<f:facet name="header">  
            			<h:outputText value="Logger" />  
        			</f:facet>   
            		<h:outputText value="#{loggingEvent.logger_name} : #{loggingEvent.caller_line}" />  
        		</p:column>        		
        		<p:column sortBy="#{loggingEvent.formatted_message}" filterBy="#{loggingEvent.formatted_message}" filterMatchMode="contains">
        			<f:facet name="header">  
            			<h:outputText value="Message" />  
        			</f:facet>   
            		<h:outputText value="#{loggingEvent.formatted_message}" />  
        		</p:column>
        		<p:column sortBy="#{loggingEvent.thread_name}" width="17%">
        			<f:facet name="header">  
            			<h:outputText value="Thread" />  
        			</f:facet>   
            		<h:outputText value="#{loggingEvent.thread_name}" />  
        		</p:column>
        		
        		<p:rowExpansion>  
		            <h:panelGrid id="displayLogDetail" columns="1" styleClass="logDetailTable" >
		            	<h:panelGrid  columns="2" columnClasses="logDetailCell">  		               
		                <h:outputText value="Event Id:" />  
		                <h:outputText id="eventId" value="#{loggingEvent.event_id}" />  	
		                <h:outputText value="Level:" />  
		                <h:outputText id="level" value="#{loggingEvent.level_string}" />  		  
		                <h:outputText value="Logger:" />  
		                <h:outputText id="logger" value="#{loggingEvent.logger_name}" />  		  
		                <h:outputText value="Time:" />  
		                <h:outputText id="time" value="#{loggingEvent.date}"/>  		  
		                <h:outputText value="Thread:" />  
		                <h:outputText id="thread" value="#{loggingEvent.thread_name}"/>		                
		                <h:outputText value="Message:" />  
		                <h:outputText id="message" value="#{loggingEvent.formatted_message}"/>
		                <h:outputText value="Class:" />  
		                <h:outputText id="class" value="#{loggingEvent.caller_class}"/>
		                <h:outputText value="Method:" />  
		                <h:outputText id="method" value="#{loggingEvent.caller_method}"/>
		                <h:outputText value="Line:" />  
		                <h:outputText id="line" value="#{loggingEvent.caller_line}"/>
		                <h:outputText value="File:" /> 
		                <h:outputText id="file" value="#{loggingEvent.caller_filename}"/>
		                </h:panelGrid>
		                <h:outputLabel value="Porperties:" styleClass="outputLabel"/>
		                <p:dataList value="#{loggingEventController.loggingEventProperties}" var="loggingEventProperty" type="definition" styleClass="logDetailList" >  
    						{#{loggingEventProperty.mapped_key} = #{loggingEventProperty.mapped_value}}  						
						</p:dataList>   		                        		
			        	<h:outputLabel value="Throwable:" styleClass="outputLabel"/>  
			        	<p:dataList value="#{loggingEventController.loggingEventExceptions}" var="loggingEventException" type="definition" styleClass="logDetailList" >  
    						#{loggingEventException.trace_line}  						
						</p:dataList>		                     	
		            </h:panelGrid>  	
        		</p:rowExpansion>
        		
            </p:dataTable>
            
            </p:panel> 
            
            </h:form>
            
            <h:form id="formSearch">
            
            <p:dialog id="searchModalDialog" header="Buscar Logs por fechas" 
            		widgetVar="searchModal" 
            		modal="true"            		
            		appendToBody="false"
            		minimizable="false"
            		maximizable="true"
            		closeOnEscape="true"     		            		
            		showEffect="fade" hideEffect="explode">  
           
	            <h:panelGroup id="searchPanel">
	               
						<h:panelGrid columns="3" columnClasses="titleCell">
			
								<p:outputLabel for="since" value="Inicio" />   
					            <p:calendar id="since" value="#{loggingEventController.since}" showOn="button" effect="slideDown" required="true" autocomplete="off">
		            				<p:watermark for="since" value="Ingrese Fecha Inicio" />
		            			</p:calendar>
					            <p:message for="since" /> 
					            <p:outputLabel for="to" value="Fin" />     					            
					            <p:calendar id="to" value="#{loggingEventController.to}" showOn="button" effect="slideDown" required="true" autocomplete="off">
		            				<p:watermark for="to" value="Ingrese Fecha Fin" />
		            			</p:calendar> 
					            <p:message for="to" />													
					        
						</h:panelGrid>
						
	            </h:panelGroup>	        	           
            	
				<p:commandButton id="searchBtn" 
					 ajax="true"					 
					 value="Buscar"					 				 
					 update="searchModalDialog,:formList:loggingEventList,:messages"					 				 
					 actionListener="#{loggingEventController.searchByDate}"					 				
					 oncomplete="if(!args.validationFailed){searchModal.hide();}else{searchModal.show();}"/>
			
				<f:facet name="footer">
						<b>* campos requeridos</b>
				</f:facet>	
				 
			</p:dialog>
			
			</h:form>
        
 </ui:define>
</ui:composition>